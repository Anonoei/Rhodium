[gcode_macro OFF_IN]
gcode:
    {% set TIME = params.T|default(15)|int %}
    {% if TIME == -1 %}
        {% set TIME = printer.configfile.settings.idle_timeout.timeout %}
        _LOG NAME="base.QoL.OFF_IN" LVL="TRACE" MSG="Set off timer to default: {TIME/60|int}m"
    {% elif TIME == 0 %}
        _LOG NAME="base.QoL.OFF_IN" LVL="TRACE" MSG="Off timer canceled"
        {% set TIME = 24 * 60 * 60 %}
    {% else %}
        _LOG NAME="base.QoL.OFF_IN" LVL="TRACE" MSG="Set off timer to {TIME}m"
        {% set TIME = TIME * 60 %}
    {% endif %}
    SET_IDLE_TIMEOUT TIMEOUT={TIME}

[gcode_macro _RAISE_ERROR]
description: Stop gcode processing
gcode:
    {% set NAME = params.NAME %}
    {% set MSG = params.MSG %}

    { action_raise_error("[" + NAME + "]" + ": " + MSG) }

[gcode_macro FORCE_HOME]
description: Ensure printer is homed
gcode:
    {% set NAME = params.NAME %}
    {% if not "xyz" in printer.toolhead.homed_axes %}
        _RAISE_ERROR NAME=base.QoL.FORCE_HOME MSG="{NAME} requires all axes homed!"
    {% endif %}